<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
          content="Control the volume and manage streaming apps on your Chromecast-enabled devices directly from your browser.">
    <meta name="author" content="@SilviuStroe">
    <meta name="keywords" content="Google Cast, Chromecast, Volume Control, Streaming, Media Control">
    <meta name="google-site-verification" content="wByruZ2Gy-r5VEMOgQZdlt5XtB-3W1Oo1EiV3aFIviI" />
    <title>Chromecast Volume Control</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicons/favicon-16x16.png">
</head>
<body class="font-sans bg-gray-100 text-gray-800 m-0 flex flex-col justify-center items-center p-2 md:p-4 lg:p-6 min-h-screen">
<div class="control-panel bg-white p-4 md:p-6 lg:p-10 rounded-lg shadow-md w-full md:w-4/5 max-w-xl mx-auto overflow-auto">
    <h1 class="text-xl md:text-3xl font-bold text-gray-800 mb-4">Chromecast Volume Control</h1>
    <p class="text-base text-gray-600 mb-6 leading-relaxed">Manage the volume of your Chromecast-enabled devices and
        switch between your favorite streaming apps with ease.</p>

    <div class="app-select-container mb-5">
        <label for="appSelect" class="block mb-2">Choose the app is playing on your device:</label>
        <select id="appSelect" required class="w-full p-2 rounded border border-gray-300 mt-1">
            <option value="">Select an app</option>
            <option value="CC32E753">Spotify</option>
            <option value="2DB7CC49">YouTube Music</option>
            <option value="B143C57E">SoundCloud</option>
            <option value="CA5E8412">Netflix</option>
            <option value="9AC194DC">Plex</option>
            <option value="233637DE">YouTube</option>
            <option value="C3DE6BC2">Disney+</option>
            <option value="10AAD887">All 4</option>
            <option value="B88B034A">Dailymotion</option>
            <option value="B3DCF968">Twitch</option>
            <option value="2BA92214">BBC iPlayer</option>
            <option value="CC1AD845">Other</option>
        </select>
    </div>

    <button id="castButton"
            class="bg-blue-600 text-white border-none py-2 px-4 rounded cursor-pointer text-lg transition-colors duration-300 block w-full box-border hover:bg-blue-700">
        Connect to Device
    </button>

    <div class="slider-container flex items-center mt-5">
        <span class="volume-label text-lg text-gray-600 mr-2">Volume:</span>
        <input type="range" id="volumeControl" min="0" max="100" step="1" disabled class="flex-grow mr-2">
        <span id="volumeValue" class="volume-value min-w-30px text-right">0</span>
    </div>
</div>
<div class="use-cases bg-gray-200 p-5 mt-8 rounded-lg shadow-md w-full md:w-4/5 max-w-xl mx-auto">
    <h2 class="text-2xl font-semibold text-gray-700">How Chromecast Volume Control Enhances Your Experience</h2>
    <p>Discover how users from various backgrounds use our app to streamline their media experience:</p>
    <ul class="list-disc ml-5">
        <li><strong>For Work and Play:</strong> Seamlessly adjust the volume during work-from-home sessions or while
            enjoying a movie night, all from your browser.
        </li>
        <li><strong>Music Lovers:</strong> Effortlessly control the volume of your favorite Spotify playlists or YouTube
            Music tracks on your Chromecast-enabled devices.
        </li>
        <li><strong>Party Hosts:</strong> Keep the party going by controlling the music volume on your
            Chromecast-enabled TV or speakers without missing a beat.
        </li>
        <li><strong>Desktop Users:</strong> Desktop users, can effortlessly control their Google
            Nest or other Chromecast-enabled devices directly from their browser.
        </li>
        <li><strong>Accessibility:</strong> Those with mobility challenges can easily adjust device settings without
            needing to physically access them.
        </li>
        <li><strong>Privacy First:</strong> This app operates without any backend servers and requires no installations,
            ensuring your data stays with you.
        </li>
    </ul>
</div>
<footer class="bg-gray-100 text-gray-800 my-2">
    <div class="container mx-auto px-4 py-5 text-center">
        <p class="mb-4">&copy; 2023 Chromecast Volume Control. All Rights Reserved.</p>
        <div class="flex justify-center space-x-4">
            <a href="mailto:chef_04bolder@icloud.com?subject=Feedback on Chromecast Volume Control" class="text-blue-500 hover:underline">Send Feedback</a>
            <a href="https://www.buymeacoffee.com/silviu" target="_blank" rel="noopener noreferrer" aria-label="Support me on Buy Me a Coffee" class="text-blue-500 hover:underline">
                ‚òïÔ∏è Support this project
            </a>
            <a href="https://github.com/BrainicHQ/CastVolumeControl" target="_blank" rel="noopener noreferrer" aria-label="View on GitHub" class="text-blue-500 hover:underline">
                üêô GitHub
            </a>
        </div>
    </div>
</footer>


<script>
    // Import cast framework
    if (window.chrome && !window.chrome.cast) {
        const script = document.createElement('script');
        script.src = 'https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1';
        script.onload = function () {
            // Wait for the SDK to be loaded
            window['__onGCastApiAvailable'] = function (isAvailable) {
                if (isAvailable) {
                    initializeCastApi();
                } else {
                    console.error('Google Cast SDK not available.');
                }
            };
        };
        document.head.appendChild(script);
    } else {
        console.error('Chromecast not supported in this browser.');
        displayCastSupportError();
    }

    function displayCastSupportError() {
        // Display an error message to the user
        alert("Sorry, Chromecast is not supported in your browser.");

        // Optionally, disable or hide Chromecast-related UI elements
        document.getElementById('castButton').disabled = true;
        document.getElementById('volumeControl').disabled = true;
    }

    function initializeCastApi() {
        const castContext = cast.framework.CastContext.getInstance();
        const appSelect = document.getElementById('appSelect');
        const castButton = document.getElementById('castButton');

        // Load the saved app selection from localStorage
        const savedAppId = localStorage.getItem('selectedAppId');
        if (savedAppId) {
            appSelect.value = savedAppId;
        }

        castButton.addEventListener('click', () => {
            const selectedAppId = appSelect.value;
            if (selectedAppId) {
                // Save the selected application ID to localStorage
                localStorage.setItem('selectedAppId', selectedAppId);

                // Update the options with the selected application ID
                castContext.setOptions({
                    receiverApplicationId: selectedAppId,
                    autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED,
                    resumeSavedSession: true
                });

                // Request a session
                castContext.requestSession().then(
                    () => console.log('Cast session started with app ID:', selectedAppId),
                    (error) => console.error('Error starting Cast session:', error)
                );
            } else {
                alert("Please select an app from the dropdown.");
            }
        });

        castContext.addEventListener(
            cast.framework.CastContextEventType.SESSION_STATE_CHANGED,
            function (event) {
                switch (event.sessionState) {
                    case cast.framework.SessionState.SESSION_STARTED:
                    case cast.framework.SessionState.SESSION_RESUMED:
                        console.log('Session started or resumed');
                        castButton.textContent = 'Disconnect';
                        const castSession = cast.framework.CastContext.getInstance().getCurrentSession();

                        // Check if there's an existing media session
                        if (castSession && castSession.getMediaSession()) {
                            console.log('Existing media session found, attaching to it');
                        } else {
                            console.log('No existing media session, handle accordingly');
                            // Handle the case where there's no existing media session
                        }

                        // Enable the volume control
                        const volumeControl = document.getElementById('volumeControl');
                        volumeControl.disabled = false;

                        // Get the current volume
                        if (castSession) {
                            const currentVolume = castSession.getVolume() * 100; // Convert to 0-100 range
                            volumeControl.value = currentVolume;
                            document.getElementById('volumeValue').textContent = currentVolume.toFixed(0); // Update the volume value display
                        }
                        break;
                    case cast.framework.SessionState.SESSION_ENDED:
                        console.log('Session ended');
                        castButton.textContent = 'Connect to Device'; // Reset button label
                        // Handle session end if necessary
                        document.getElementById('volumeControl').disabled = true;
                        break;
                }
            }
        );
    }


    function adjustVolume(volumeLevel) {
        const castSession = cast.framework.CastContext.getInstance().getCurrentSession();
        if (castSession) {
            // Normalize volume level to a value between 0.0 and 1.0
            let normalizedVolume = volumeLevel / 100;

            castSession.setVolume(normalizedVolume).then(
                () => console.log('Volume set to ' + normalizedVolume),
                (error) => console.error('Error setting volume:', error)
            );
        } else {
            console.log('No active Cast session');
        }
    }

    document.getElementById('volumeControl').addEventListener('input', function (event) {
        adjustVolume(event.target.value);
        document.getElementById('volumeValue').textContent = event.target.value;
    });
</script>
<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            navigator.serviceWorker.register('/service-worker.js').then(function(registration) {
                console.log('ServiceWorker registration successful with scope: ', registration.scope);
            }, function(err) {
                console.log('ServiceWorker registration failed: ', err);
            });
        });
    }
</script>
</body>
</html>